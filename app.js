/* eslint-disable eol-last */
/* eslint-disable space-before-function-paren */
/* eslint-disable indent */
/* eslint-disable no-undef */
const bord = [
    [
        [
            { name: '砲', side: 'black' },
            { name: '忍', side: 'black' },
            { name: '馬', side: 'black' }
        ],
        [
            { name: '砲', side: 'black' },
            { name: '忍', side: 'black' },
            { name: '馬', side: 'black' }
        ],
        [
            { name: '砲', side: 'black' },
            { name: '忍', side: 'black' },
            { name: '馬', side: 'black' }
        ],
        [
            { name: '砲', side: 'black' },
            { name: '忍', side: 'black' },
            { name: '馬', side: 'black' }
        ],
        [
            { name: '砲', side: 'black' },
            { name: '忍', side: 'black' },
            { name: '馬', side: 'black' }
        ]
    ],
    [
        [
            { name: '砲', side: 'black', file: 1, rank: 5, Hierarchie: 1 },
            { name: '忍', side: 'black', file: 1, rank: 5, Hierarchie: 2 },
            { name: '馬', side: 'black', file: 1, rank: 5, Hierarchie: 3 }
        ],
        [
            { name: '砲', side: 'black', file: 2, rank: 5, Hierarchie: 1 },
            { name: '忍', side: 'black', file: 2, rank: 5, Hierarchie: 2 },
            { name: '馬', side: 'black', file: 2, rank: 5, Hierarchie: 3 }
        ],
        [
            { name: '砲', side: 'black', file: 2, rank: 5, Hierarchie: 1 },
            { name: '忍', side: 'black', file: 2, rank: 5, Hierarchie: 1 },
            { name: '馬', side: 'black', file: 2, rank: 5, Hierarchie: 1 }
        ],
        [
            { name: '砲', side: 'black', file: 2, rank: 5, Hierarchie: 1 },
            { name: '忍', side: 'black', file: 2, rank: 5, Hierarchie: 1 },
            { name: '馬', side: 'black', file: 2, rank: 5, Hierarchie: 1 }
        ],
        [
            { name: '砲', side: 'black', file: 2, rank: 5, Hierarchie: 1 },
            { name: '忍', side: 'black', file: 2, rank: 5, Hierarchie: 1 },
            { name: '馬', side: 'black', file: 2, rank: 5, Hierarchie: 1 }
        ]
    ],
    [
        [
            { name: '', side: 'black', file: 2, rank: 5, Hierarchie: 1 },
            { name: '', side: 'black', file: 2, rank: 5, Hierarchie: 1 },
            { name: '', side: 'black', file: 2, rank: 5, Hierarchie: 1 }
        ],
        [
            { name: '', side: 'black', file: 2, rank: 5, Hierarchie: 1 },
            { name: '', side: 'black', file: 2, rank: 5, Hierarchie: 1 },
            { name: '', side: 'black', file: 2, rank: 5, Hierarchie: 1 }
        ],
        [
            { name: '', side: 'black', file: 2, rank: 5, Hierarchie: 1 },
            { name: '', side: 'black', file: 2, rank: 5, Hierarchie: 1 },
            { name: '', side: 'black', file: 2, rank: 5, Hierarchie: 1 }
        ],
        [
            { name: '', side: 'black', file: 2, rank: 5, Hierarchie: 1 },
            { name: '', side: 'black', file: 2, rank: 5, Hierarchie: 1 },
            { name: '', side: 'black', file: 2, rank: 5, Hierarchie: 1 }
        ],
        [
            { name: '', side: 'black', file: 2, rank: 5, Hierarchie: 1 },
            { name: '', side: 'black', file: 2, rank: 5, Hierarchie: 1 },
            { name: '', side: 'black', file: 2, rank: 5, Hierarchie: 1 }
        ]
    ],
    [
        [
            { name: '砲', side: 'white', file: 2, rank: 5, Hierarchie: 1 },
            { name: '忍', side: 'white', file: 2, rank: 5, Hierarchie: 1 },
            { name: '馬', side: 'white', file: 2, rank: 5, Hierarchie: 1 }
        ],
        [
            { name: '砲', side: 'white', file: 2, rank: 5, Hierarchie: 1 },
            { name: '忍', side: 'white', file: 2, rank: 5, Hierarchie: 1 },
            { name: '馬', side: 'white', file: 2, rank: 5, Hierarchie: 1 }
        ],
        [
            { name: '砲', side: 'white', file: 2, rank: 5, Hierarchie: 1 },
            { name: '忍', side: 'white', file: 2, rank: 5, Hierarchie: 1 },
            { name: '馬', side: 'white', file: 2, rank: 5, Hierarchie: 1 }
        ],
        [
            { name: '砲', side: 'white', file: 2, rank: 5, Hierarchie: 1 },
            { name: '忍', side: 'white', file: 2, rank: 5, Hierarchie: 1 },
            { name: '馬', side: 'white', file: 2, rank: 5, Hierarchie: 1 }
        ],
        [
            { name: '砲', side: 'white', file: 2, rank: 5, Hierarchie: 1 },
            { name: '忍', side: 'white', file: 2, rank: 5, Hierarchie: 1 },
            { name: '馬', side: 'white', file: 2, rank: 5, Hierarchie: 1 }
        ]
    ],
    [
        [
            { name: '砲', side: 'white', file: 2, rank: 5, Hierarchie: 1 },
            { name: '忍', side: 'white', file: 2, rank: 5, Hierarchie: 1 },
            { name: '馬', side: 'white', file: 2, rank: 5, Hierarchie: 1 }
        ],
        [
            { name: '砲', side: 'white', file: 2, rank: 5, Hierarchie: 1 },
            { name: '忍', side: 'white', file: 2, rank: 5, Hierarchie: 1 },
            { name: '馬', side: 'white', file: 2, rank: 5, Hierarchie: 1 }
        ],
        [
            { name: '砲', side: 'white', file: 2, rank: 5, Hierarchie: 1 },
            { name: '忍', side: 'white', file: 2, rank: 5, Hierarchie: 1 },
            { name: '馬', side: 'white', file: 2, rank: 5, Hierarchie: 1 }
        ],
        [
            { name: '砲', side: 'white', file: 2, rank: 5, Hierarchie: 1 },
            { name: '忍', side: 'white', file: 2, rank: 5, Hierarchie: 1 },
            { name: '馬', side: 'white', file: 2, rank: 5, Hierarchie: 1 }
        ],
        [
            { name: '砲', side: 'white', file: 2, rank: 5, Hierarchie: 1 },
            { name: '忍', side: 'white', file: 2, rank: 5, Hierarchie: 1 },
            { name: '馬', side: 'white', file: 2, rank: 5, Hierarchie: 1 }
        ]
    ]
]

function CreateBordData(gameName, turnNo, phaseColor, bordDeployment) {
    const jsonData = {
        gameName: gameName,
        bordCondition: {
            turnNo: turnNo,
            phaseColor: phaseColor,
            bordDeployment: bordDeployment
        }
    }
    return jsonData
}

// set gamelist to continue-window
async function SetGameList() {
    const files = await window.manipulateDb.getFileName()
    d3.select('#fileName').selectAll('option').data(files).enter().append('option').attr('value', (d) => {
        return d
    }).text((d) => {
        return d
    })
}

async function CreateNewGame() {
    const gameName = document.getElementById('newfileName').value
    await window.manipulateDb.createTable(gameName)
    const bordData = CreateBordData(gameName, 0, 'white', bord)
    const bordCondition = await window.manipulateDb.addData(bordData)
    console.log(bordCondition)
}

// load game condition from electronDB
async function LoadBordData(dataName) {
    return lastData
}

// make current-bord conditon data that forms json

// rendering bord-condition to htmlpage that based on bord-data
function RenderBord(bord) {
    const borddata = d3.select('#bord').append('table').append('tbody').selectAll('tr').data(bord).enter().append('tr')
        .selectAll('td').data((d) => d).enter().append('td')
        .selectAll('div').data((d) => d).enter().append('div')

    borddata.text((d) => d.name)

    borddata.style('transform', (d) => {
        if (d.side === 'black') {
            return 'rotateX( 180deg )'
        }
    })

    borddata.attr('class', 'piece').attr('draggable', 'true')

    const attrList = ['Hierarchie', 'file', 'rank']

    attrList.forEach(e => {
        borddata.attr(e, (d) => d[e])
    })

    d3.selectAll('td').style('background-color', (d, i) => {
        return i % 2 ? 'white' : 'gray'
    })
}

async function vanish() {
    const _sleep = (ms) => new Promise((resolve) => setTimeout(resolve, ms))
    document.getElementById('open').style.opacity = 0
    await _sleep(1000)
    document.getElementById('open').style.display = 'none'
    document.getElementById('container').style.opacity = 1
}

async function addDatas() {
    await window.manipulateDb.addData(bord)
}

async function searchDatas() {
    await window.manipulateDb.searchData()
}

function changeHierarchieHight() {
    button1.style.opacity = '100%'
    button2.style.opacity = '30%'
    button3.style.opacity = '30%'
    button4.style.opacity = '30%'
    d3.selectAll('.piece').style('display', (d, i) => {
        return i % 3 === 0 ? 'block' : 'none'
    })
}

function changeHierarchieMiddle() {
    button2.style.opacity = '100%'
    button1.style.opacity = '30%'
    button3.style.opacity = '30%'
    button4.style.opacity = '30%'
    d3.selectAll('.piece').style('display', (d, i) => {
        return i % 3 === 1 ? 'block' : 'none'
    })
}

function changeHierarchieLow() {
    button3.style.opacity = '100%'
    button1.style.opacity = '30%'
    button2.style.opacity = '30%'
    button4.style.opacity = '30%'
    d3.selectAll('.piece').style('display', (d, i) => {
        return i % 3 === 2 ? 'block' : 'none'
    })
}

function changeHierarchieFull() {
    button3.style.opacity = '30%'
    button1.style.opacity = '30%'
    button2.style.opacity = '30%'
    button4.style.opacity = '100%'
    d3.selectAll('.piece').style('display', 'block')
}

SetGameList()

const pieces = document.getElementsByClassName('piece')
const button0 = document.getElementById('button0')
const button1 = document.getElementById('button1')
const button2 = document.getElementById('button2')
const button3 = document.getElementById('button3')
const button4 = document.getElementById('button4')
const button99 = document.getElementById('button99')
const button9999 = document.getElementById('button9999')

button0.addEventListener('click', vanish, false)
button1.addEventListener('click', changeHierarchieHight, false)
button2.addEventListener('click', changeHierarchieMiddle, false)
button3.addEventListener('click', changeHierarchieLow, false)
button4.addEventListener('click', changeHierarchieFull, false)
button99.addEventListener('click', CreateNewGame, false)
button9999.addEventListener('click', addDatas, false)

function onDragstart(e) {
    console.log('drag start')
    e.dataTransfer.setData('text', this.innerText)
}

function onDragover(e) {
    e.preventDefault()
    console.log('drag over')
    e.dataTransfer.setData('text', this.innerText)
}

function onDrop(e) {
    console.log('drop')
    e.preventDefault()
    const ans = e.dataTransfer.getData('text')
    e.target.innerText = ans
        // TODO:bordデータを書き換え
}
for (let i = 0; i < pieces.length; i++) {
    pieces[i].addEventListener('dragstart', onDragstart, false)
    pieces[i].addEventListener('dragover', onDragover, false)
    pieces[i].addEventListener('drop', onDrop, false)
}